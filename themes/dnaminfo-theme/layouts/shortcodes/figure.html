{{/* Usage: 
    {{% figure src="path" id="unique ID for figcaption" caption="figure caption" alt="alt-text"
        style="optional css style" class="optional css class" noresize="turn off auto resizing"
    %}} 
*/}}
<<<<<<< HEAD
{{- $base_url := site.Params.cloudinary_url -}}
=======
{{- $path := .Get "src" }}
>>>>>>> local-images
{{- $img := .Get "src" -}}
{{- $alt_text := (.Get "alt" | default (.Get "caption") | default "") -}}
<figure 
  {{- with (.Get "class") }} class="{{ . }}"{{ end }}
  {{- with (.Get "style") }} style="{{ . | safeCSS }}"{{ end }} >
{{- if (.Get "caption") -}}
  {{- $fig_id := .Get "id" | default $img -}}
  <label for="fig-{{ $fig_id }}" class="margin-toggle toggle-with-word">caption</label>
  <input type="checkbox" id="fig-{{ $fig_id }}" class="margin-toggle" />
  <figcaption class="marginnote">
      {{ .Get "caption" | markdownify | safeHTML }}
  </figcaption>
{{- end -}}
<picture>
{{- if in $img "http" -}}{{/* from external source */}}
  <img
    {{ with (.Get "class") -}} class="{{ . }}"{{- end -}}
    {{- with (.Get "style") -}} style="{{ . | safeCSS }}"{{- end -}}
    src='{{ $img }}'
    alt='{{ .Get "alt" }}' />
{{- else -}}{{/* from internal source */}}
  {{- if in $img "svg" -}}{{/* vector graphics */}}
    <img
      width="100%" height="auto"
      {{ with (.Get "class") -}} class="{{ . }}"{{- end -}}
      {{- with (.Get "style") -}} style="{{ . }}"{{- end -}}
      src='{{ printf "%s/%s" $base_url $img }}'
      alt='{{ .Get "alt" }}' />
  {{- else -}}{{/* all other graphics */}}
    {{- $img_options := dict 
        "image" $img
        "alt" (.Get "alt")
        "class" (.Get "class")
        "style" (.Get "style")
        "loc" (.Get "loc") -}}
    {{ partial "resp-image" $img_options }}
  {{- end -}}
{{- end -}}
</picture>
</figure>