{{/* recursively render the items in a menu 
    parameters:
        "menu": the key for .Site.Menus
        "list": the list of pages
        "current": the current page (.)
*/}}
{{- $menu_id := .menu }}
{{- $list := .list }}
{{- $current_page := .current }}
{{ range $list }}
  {{/* top items */}}
  <li{{ if $current_page.IsMenuCurrent $menu_id . }} class="current"{{ end }}>
  {{- if .URL -}}
    <a href="{{ .URL }}" title="{{ .Title }}">{{ .Name }}</a>
  {{- else -}}
    {{ .Name }}
  {{- end -}}
  </li>

  {{/* child items */}}
  {{- if and 
      .HasChildren
      (or 
          ($current_page.IsMenuCurrent $menu_id .)
          ($current_page.HasMenuCurrent $menu_id .)) }}
      <ul>
      {{ partial "menu-item" (dict "menu" $menu_id "list" .Children "current" $current_page) }}
      </ul>
  {{ end }}
{{ end }}{{/* end range */}}